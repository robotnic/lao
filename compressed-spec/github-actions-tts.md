# GitHub Actions TTS Audio Generation - ARCHIVED

‚ö†Ô∏è **This document is archived.** See the canonical setup guides:

- **Quick Start**: [AUDIO_GENERATION_QUICKSTART.md](../AUDIO_GENERATION_QUICKSTART.md)
- **Complete Setup**: [AUDIO_GENERATION_SETUP.md](../AUDIO_GENERATION_SETUP.md)

For reference only. Implementation completed.

---

## Historical Context

This guide walks you through setting up automated audio generation using GitHub Actions. Instead of generating audio files locally, the workflow runs in the cloud, generates professional-quality audio files, and automatically commits them to your repository.

### How It Works

```
1. Manual trigger or scheduled (weekly)
   ‚Üì
2. GitHub Actions workflow starts
   ‚Üì
3. Download knowledge base
   ‚Üì
4. Call TTS service (Azure/AWS/Google Cloud)
   ‚Üì
5. Generate 61 MP3 files (~2 minutes)
   ‚Üì
6. Validate audio quality
   ‚Üì
7. Commit to repository
   ‚Üì
8. Create PR with changes
   ‚Üì
9. App uses new high-quality audio
```

---

## Prerequisites

- GitHub repository with write access
- TTS service account (choose one):
  - **Azure Speech Services** (recommended - free tier available)
  - **AWS Polly** (free tier: 5M chars/month)
  - **Google Cloud TTS** (billing required)
  - **Gemini API** (free tier: 1,500 requests/day)

---

## Option 1: Azure Speech Services (Recommended)

### Step 1: Create Azure Account & Service

1. Go to [Azure Portal](https://portal.azure.com)
2. Create resource ‚Üí Search "Speech"
3. Create "Speech" service
4. Choose region: `westus` or `eastus`
5. Pricing: **Free tier** (5,000 requests/month free)

### Step 2: Get Credentials

1. In Azure Portal, go to your Speech resource
2. Copy these two values:
   - **API Key**: Under "Keys and Endpoint" ‚Üí Key 1
   - **Region**: Listed as "Location" (e.g., `westus`)

### Step 3: Add to GitHub Secrets

1. Go to GitHub repo ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
2. Click "New repository secret"
3. Add two secrets:

   **Secret 1:**
   - Name: `AZURE_SPEECH_KEY`
   - Value: `<your-api-key-from-step-2>`

   **Secret 2:**
   - Name: `AZURE_SPEECH_REGION`
   - Value: `westus` (or your region)

### Step 4: Create Workflow File

Create `.github/workflows/generate-audio-azure.yml`:

```yaml
name: Generate Audio Files (Azure TTS)

on:
  schedule:
    - cron: '0 0 * * 0'  # Weekly on Sunday at midnight UTC
  workflow_dispatch:      # Manual trigger from GitHub UI
  
jobs:
  generate-audio:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm install --save-dev @azure/cognitiveservices-speech
      
      - name: Generate audio files
        env:
          AZURE_SPEECH_KEY: ${{ secrets.AZURE_SPEECH_KEY }}
          AZURE_SPEECH_REGION: ${{ secrets.AZURE_SPEECH_REGION }}
        run: |
          node scripts/generate-audio-azure.js
      
      - name: Validate audio files
        run: |
          node scripts/validate-audio.js
      
      - name: Commit and push if files changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'chore: regenerate audio files from Azure TTS'
          file_pattern: 'src/assets/audio/*.mp3'
          create_branch: true
          skip_fetch: false
          skip_checkout: false
          
      - name: Create Pull Request
        if: steps.auto-commit.outputs.changes_detected == 'true'
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'chore: regenerate audio files'
          title: 'Audio: Regenerate high-quality audio files'
          body: |
            ## Audio Generation Complete
            
            Generated by GitHub Actions using Azure Text-to-Speech.
            
            ### Details
            - **Files generated:** 61 MP3 files
            - **Total size:** ~1.5-2 MB
            - **Quality:** Professional Azure Neural Voices
            - **Workflow run:** [${{ github.run_id }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
            
            ### Checklist
            - [ ] Audio quality is acceptable
            - [ ] All 61 files generated successfully
            - [ ] File sizes are reasonable
            
          branch: audio-update-${{ github.run_number }}
          delete-branch: true
```

---

## Option 2: AWS Polly

### Step 1: Create AWS Account & Credentials

1. Go to [AWS Console](https://console.aws.amazon.com)
2. Create IAM user with Polly access:
   - Services: Polly (read-only)
3. Generate access key & secret key

### Step 2: Add to GitHub Secrets

1. Go to GitHub repo ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
2. Add three secrets:
   - `AWS_ACCESS_KEY_ID`: Your access key
   - `AWS_SECRET_ACCESS_KEY`: Your secret key
   - `AWS_REGION`: `us-east-1`

### Step 3: Create Workflow

Create `.github/workflows/generate-audio-aws.yml`:

```yaml
name: Generate Audio Files (AWS Polly)

on:
  schedule:
    - cron: '0 0 * * 0'
  workflow_dispatch:
  
jobs:
  generate-audio:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm install aws-sdk
      
      - name: Generate audio files
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_REGION: ${{ secrets.AWS_REGION }}
        run: |
          node scripts/generate-audio-aws.js
      
      - name: Validate audio files
        run: |
          node scripts/validate-audio.js
      
      - name: Commit and push if files changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'chore: regenerate audio files from AWS Polly'
          file_pattern: 'src/assets/audio/*.mp3'
```

---

## Option 3: Google Cloud TTS

### Step 1: Create Google Cloud Credentials

1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Enable Text-to-Speech API
3. Create service account key (JSON format)
4. Download the JSON file

### Step 2: Add to GitHub Secrets

1. GitHub repo ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
2. Add secret:
   - Name: `GOOGLE_CLOUD_KEY`
   - Value: Paste entire JSON content from Step 1

### Step 3: Create Workflow

```yaml
name: Generate Audio Files (Google Cloud)

on:
  schedule:
    - cron: '0 0 * * 0'
  workflow_dispatch:
  
jobs:
  generate-audio:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Setup Google Cloud credentials
        run: |
          echo '${{ secrets.GOOGLE_CLOUD_KEY }}' > /tmp/gcp-key.json
          export GOOGLE_APPLICATION_CREDENTIALS=/tmp/gcp-key.json
      
      - name: Install dependencies
        run: npm install @google-cloud/text-to-speech
      
      - name: Generate audio files
        env:
          GOOGLE_APPLICATION_CREDENTIALS: /tmp/gcp-key.json
        run: |
          node scripts/generate-audio-google.js
      
      - name: Validate audio files
        run: |
          node scripts/validate-audio.js
```

---

## How to Trigger the Workflow

### Option A: Manual Trigger (Recommended for First Run)

1. Go to GitHub repo
2. Click "Actions" tab
3. Select your workflow (e.g., "Generate Audio Files (Azure TTS)")
4. Click "Run workflow"
5. Check logs in real-time

### Option B: Automatic Schedule

The workflow runs automatically on:
- **Day:** Sunday
- **Time:** Midnight UTC
- **Frequency:** Weekly

To change the schedule, edit the cron expression:

```yaml
schedule:
  - cron: '0 0 * * 0'  # Sunday at midnight UTC
  # Change to:
  - cron: '0 12 * * 3'  # Wednesday at noon UTC
```

[Cron Expression Generator](https://crontab.guru)

---

## Required Scripts

### 1. Generate Audio Script (`scripts/generate-audio-azure.js`)

```javascript
const fs = require('fs');
const path = require('path');
const sdk = require('microsoft-cognitiveservices-speech-sdk');

const speechConfig = sdk.SpeechConfig.fromSubscription(
  process.env.AZURE_SPEECH_KEY,
  process.env.AZURE_SPEECH_REGION
);

// Load knowledge base
const kbPath = path.join(__dirname, '../src/assets/data/knowledge_base.json');
const knowledgeBase = JSON.parse(fs.readFileSync(kbPath, 'utf8'));

const audioDir = path.join(__dirname, '../src/assets/audio');
if (!fs.existsSync(audioDir)) fs.mkdirSync(audioDir, { recursive: true });

let successCount = 0;
let failureCount = 0;

async function generateAudio(entry) {
  const audioPath = path.join(audioDir, `${entry.audio_key}.mp3`);
  
  if (fs.existsSync(audioPath)) {
    console.log(`‚è≠Ô∏è  Skipping ${entry.audio_key}`);
    return;
  }
  
  const text = entry.lao || entry.english || entry.name || '';
  if (!text) {
    console.log(`‚ö†Ô∏è  Skipping ${entry.audio_key} (no text)`);
    return;
  }
  
  try {
    console.log(`üéµ Generating ${entry.audio_key}...`);
    
    const audioConfig = sdk.AudioConfig.fromAudioFileOutput(audioPath);
    const synthesizer = new sdk.SpeechSynthesizer(speechConfig, audioConfig);
    
    await new Promise((resolve, reject) => {
      synthesizer.speakTextAsync(text,
        result => {
          if (result.reason === sdk.ResultReason.SynthesizingAudioCompleted) {
            console.log(`‚úÖ Generated ${entry.audio_key}`);
            successCount++;
            resolve();
          } else {
            reject(new Error(result.errorDetails));
          }
        },
        error => reject(error)
      );
    });
  } catch (error) {
    console.error(`‚ùå Failed ${entry.audio_key}:`, error.message);
    failureCount++;
  }
}

async function main() {
  const entries = [
    ...(knowledgeBase.alphabet || []),
    ...(knowledgeBase.dictionary || []),
    ...(knowledgeBase.phrases || [])
  ];
  
  for (const entry of entries) {
    await generateAudio(entry);
    await new Promise(r => setTimeout(r, 100)); // Rate limiting
  }
  
  console.log(`\n‚úÖ Generated: ${successCount}`);
  console.log(`‚ùå Failed: ${failureCount}`);
  process.exit(failureCount > 0 ? 1 : 0);
}

main();
```

### 2. Validation Script (`scripts/validate-audio.js`)

```javascript
const fs = require('fs');
const path = require('path');

const audioDir = path.join(__dirname, '../src/assets/audio');
const files = fs.readdirSync(audioDir).filter(f => f.endsWith('.mp3'));

console.log(`Validating ${files.length} audio files...\n`);

let valid = 0;
let invalid = 0;

files.forEach(file => {
  const filepath = path.join(audioDir, file);
  const stats = fs.statSync(filepath);
  const size = stats.size;
  
  if (size < 5000) {
    console.log(`‚ùå ${file} (${size} bytes - too small)`);
    invalid++;
  } else if (size > 500000) {
    console.log(`‚ö†Ô∏è  ${file} (${size} bytes - large)`);
    valid++;
  } else {
    console.log(`‚úÖ ${file} (${size} bytes)`);
    valid++;
  }
});

console.log(`\n‚úÖ Valid: ${valid}`);
console.log(`‚ùå Invalid: ${invalid}`);
console.log(`üìä Total: ${files.length}`);

process.exit(invalid > 0 ? 1 : 0);
```

---

## Monitoring & Troubleshooting

### View Workflow Runs

1. Go to GitHub repo ‚Üí Actions tab
2. Select your workflow
3. See all runs with status (‚úÖ success, ‚ùå failed)

### Common Issues

| Issue | Solution |
|-------|----------|
| "Secret not found" | Make sure secret names match exactly (case-sensitive) |
| "Timeout after 30 min" | Some files take longer; increase timeout to 45 min |
| "API rate limits" | Add delays between requests; Azure has 20 reqs/sec limit |
| "No files generated" | Check logs; validate TTS service is enabled |
| "Invalid MP3 files" | Run validation script; check TTS service returned valid audio |

### Viewing Logs

1. Click workflow run
2. Expand "Generate audio files" step
3. Scroll through logs to see errors

---

## Cost Analysis

### Azure Speech Services
- **Free tier:** 5,000 requests/month (enough for 5 full generations)
- **Paid:** $4/M characters after free tier
- **For 61 files:** ~$0.01 per generation

### AWS Polly
- **Free tier:** 5M characters/month (first year)
- **Paid:** $4/M characters
- **For 61 files:** ~$0.01-0.02 per generation

### Google Cloud TTS
- **Free tier:** None (but $300 credit for new accounts)
- **Paid:** $16/M characters
- **For 61 files:** ~$0.05 per generation

### Gemini API
- **Free tier:** 1,500 requests/day
- **For 61 files:** 1 request per file = 61/day (well within limit)
- **Cost:** Free (but corporate firewall blocks it)

---

## Advanced: Custom Voice Settings

### Azure TTS Voice Options

```javascript
const speechConfig = sdk.SpeechConfig.fromSubscription(key, region);

// Female voice (recommended for learning)
speechConfig.speechSynthesisVoiceName = 'en-US-AriaNeural';

// Male voice option
speechConfig.speechSynthesisVoiceName = 'en-US-GuyNeural';

// Speaking rate (0.5 = half speed, 2.0 = double speed)
// Default = 1.0
const ssml = `
  <speak>
    <prosody rate="0.9">
      ${text}
    </prosody>
  </speak>
`;
```

### AWS Polly Voice Options

```javascript
const params = {
  OutputFormat: 'mp3',
  Text: text,
  TextType: 'text',
  VoiceId: 'Joanna',  // Female voice
  // Other options: 'Matthew' (male), 'Kendra' (female), etc.
};
```

---

## Next Steps

1. **Choose TTS service** (Azure recommended)
2. **Create GitHub secrets** (API keys)
3. **Create workflow file** (.github/workflows/generate-audio.yml)
4. **Add required scripts** (scripts/generate-audio-*.js)
5. **Test manually** (workflow_dispatch)
6. **Monitor first run** (check logs, validate audio quality)
7. **Enable schedule** (weekly automatic generation)

---

## Success Checklist

- [ ] TTS service account created
- [ ] GitHub Secrets configured
- [ ] Workflow file created
- [ ] Scripts installed in repo
- [ ] Workflow runs successfully
- [ ] All 61 audio files generated
- [ ] Files are valid MP3s
- [ ] Audio quality is professional
- [ ] PR created with updated files
- [ ] Audio plays in app without TTS fallback

---

## Support & References

- [GitHub Actions Documentation](https://docs.github.com/actions)
- [Azure Speech Services](https://azure.microsoft.com/services/cognitive-services/text-to-speech/)
- [AWS Polly Documentation](https://docs.aws.amazon.com/polly/)
- [Microsoft Speech SDK for Node.js](https://github.com/Microsoft/cognitive-services-speech-sdk-js)
- [Create Pull Request Action](https://github.com/peter-evans/create-pull-request)
